{% extends "base.html" %}
{% block content %}

<form class="row g-2 mb-3" id="searchForm" method="get" action="/">
  <div class="col-md-7">
    <input class="form-control" name="q" value="{{ request.args.get('q','') }}"
           placeholder="Search by item or description">
  </div>

  
  <input type="hidden" name="cat" id="hiddenCat" value="{{ request.args.get('cat','') }}">
  <input type="hidden" name="place" id="hiddenPlace" value="{{ request.args.get('place','') }}">

  <div class="col-md-2 d-grid">
    <button type="button" class="btn btn-outline-light" id="filtersBtn">Filters</button>
  </div>
  <div class="col-md-3 d-grid">
    <button class="btn btn-primary">Search</button>
  </div>
</form>


<div class="modal fade" id="filtersModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Filters</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        
        <div class="mb-3">
          <label class="form-label">Category</label>
          <select class="form-select" id="filterCategory">
            <option value="">All categories</option>
            {% for c in categories %}
              <option value="{{ c }}" {% if request.args.get('cat')==c %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>
        </div>

        <hr class="text-secondary">

        
        <div class="mb-2">
          <label class="form-label">Place</label>
          <select class="form-select" id="filterPlace">
            <option value="">Any place</option>
            {% for p in places %}
              <option value="{{ p }}" {% if request.args.get('place')==p %}selected{% endif %}>{{ p }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" id="filtersClear">Clear</button>
        <button type="button" class="btn btn-primary" id="filtersApply">Apply</button>
      </div>
    </div>
  </div>
</div>

<ul class="nav nav-pills mb-3 justify-content-center" id="pills-tab" role="tablist">
  <li class="nav-item" role="presentation">
    <button class="nav-link active" id="got-tab" data-bs-toggle="pill" data-bs-target="#got" type="button" role="tab">Got Something</button>
  </li>
  <li class="nav-item" role="presentation">
    <button class="nav-link" id="lost-tab" data-bs-toggle="pill" data-bs-target="#lost" type="button" role="tab">Lost Something</button>
  </li>
</ul>

<div class="tab-content" id="pills-tabContent">
  
  <div class="tab-pane fade show active" id="got" role="tabpanel">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>Items people have FOUND</h4>
      <button class="btn btn-success" onclick="openPostModal('found')">Found something</button>
    </div>
    {{ render_cards(found_posts, 'found') }}
  </div>

  
  <div class="tab-pane fade" id="lost" role="tabpanel">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4>Items people have LOST</h4>
      <button class="btn btn-danger" onclick="openPostModal('lost')">I Lost It</button>
    </div>
    {{ render_cards(lost_posts, 'lost') }}
  </div>
</div>


<div class="modal fade" id="postModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="postModalTitle"></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <form method="post" enctype="multipart/form-data" id="postForm">
        <div class="modal-body">

          <input type="hidden" name="kind" id="postKind">

          <div class="row g-2">
            <div class="col-md-6">
              <label class="form-label">Item name</label>
              <input class="form-control" name="item_name" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Hostel Block</label>
              <input class="form-control" name="hostel" value="{{ user['hostel'] if user else '' }}" required>
            </div>
          </div>
          
          <div class="row g-2 mt-1">
            <div class="col-md-6">
                <label class="form-label">Category</label>
                <select class="form-select" name="category" required>
                 {% for c in categories %}
                     <option value="{{ c }}">{{ c }}</option>
                 {% endfor %}
                </select>
            </div>
          </div>
          
          <div class="row g-2 mt-1">
            <div class="col-md-6">
                <label class="form-label">Place</label>
                <select class="form-select" name="place" required>
                 {% for p in places %}
                     <option value="{{ p }}">{{ p }}</option>
                 {% endfor %}
                </select>
            </div>
          </div>

          <div class="mt-2">
            <label class="form-label">Description</label>
            <textarea class="form-control" name="description" rows="2"></textarea>
          </div>

          <div class="row g-2 mt-1">
            <div class="col-md-4">
              <label class="form-label">Your Name</label>
              <input class="form-control" name="name" value="{{ user['name'] if user else '' }}" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Enrollment No.</label>
              <input class="form-control" name="enrollment" value="{{ user['enrollment'] if user else '' }}" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Phone</label>
              <input class="form-control" name="phone" value="{{ user['phone'] if user else '' }}" required>
            </div>
          </div>

          <div class="mt-3">
            <label class="form-label">Upload up to 3 images</label>
            <input type="file" class="form-control" name="images" multiple accept="image/*">
          </div>

        </div>
        <div class="modal-footer">
          <button class="btn btn-primary">Post</button>
        </div>
      </form>

    </div>
  </div>
</div>

{% endblock %}
